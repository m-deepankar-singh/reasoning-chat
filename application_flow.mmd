graph TD
    %% Main Application Setup
    A[FastAPI Application] --> B[CORS Middleware]
    B --> C[Upload Config Middleware]
    
    %% Database Initialization
    A --> D[Initialize SQLite DB]
    
    %% Router Integration
    A --> E[Chat Router]
    A --> F[Files Router]
    
    %% Chat Flow
    E --> G[/chat Endpoint]
    G --> H{Enable Doc Context?}
    H -->|Yes| I[Process Markdown Documents]
    I --> J[Process Raw Documents]
    H -->|No| K[Regular Chat Processing]
    
    %% Reasoning Flow
    K --> L{Enable Reasoning?}
    L -->|Yes| M[DeepSeek Reasoner]
    L -->|No| N[Direct Response]
    
    %% Response Processing
    M --> O[Generate Response]
    N --> O
    O --> P[Save to Conversation]
    P --> Q[Store in Database]
    
    %% Additional Endpoints
    E --> R[/conversation Endpoint]
    E --> S[/test-llm Endpoint]
    E --> T[/test-deepseek Endpoint]
    
    %% Data Flow
    U[ChatRequest Schema] --> G
    O --> V[ChatResponse Schema]
    
    %% Services
    W[Model Manager Service] --> M
    X[Reasoning Engine Service] --> O
    Y[Document Context Service] --> I
    
    %% Database Operations
    Z[ConversationDB] --> Q
    R --> Z
    
    %% Styling
    classDef endpoint fill:#f9f,stroke:#333,stroke-width:2px
    classDef service fill:#bbf,stroke:#333,stroke-width:2px
    classDef schema fill:#bfb,stroke:#333,stroke-width:2px
    
    class G,R,S,T endpoint
    class W,X,Y service
    class U,V schema 